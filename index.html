<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=9" >
	<title>Syntax Tree Generator</title>

	<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-29882027-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
	</script>
</head>


<body>
	<div id="accordion">
		<h3><a href="#">Syntax Tree Generator</a></h3><div style="text-align:left">
			<textarea id="i" rows="3">[S [NP This] [VP [V is] [^NP a wug]]]</textarea>
			(C) 2011 by <a href="mailto:mail@mshang.ca">Miles Shang</a>, see <a href="LICENSE.txt">license</a>.
		</div>
		
		<h3><a href="#">Options</a></h3><div>
			<table>
				<tr>
					<td colspan="2" align="center"><div id="font-style-radio">
						<input type="radio" name="font-style" id="serif" value="serif" class="redraw" /><label for="serif">Serif</label>
						<input type="radio" name="font-style" id="sans-serif" value="sans-serif" class="redraw" checked /><label for="sans-serif">Sans-Serif</label>
						<input type="radio" name="font-style" id="monospace" value="monospace" class="redraw" /><label for="monospace">Monospace</label>
					</div></td>
				</tr>
				<tr>
					<td align="center" width="50%">Terminals:</td>
					<td align="center" width="50%">Non-terminals:</td>
				</tr>
				<tr>
					<td align="center" width="50%"><div id="term-font-check">
						<input type="checkbox" id="term-bold" class="redraw" /><label for="term-bold">Bold</label>
						<input type="checkbox" id="term-ital" class="redraw" /><label for="term-ital">Italic</label>
					</span></td>
					<td align="center" width="50%"><div id="nonterm-font-check">
						<input type="checkbox" id="nonterm-bold" class="redraw" /><label for="nonterm-bold">Bold</label>
						<input type="checkbox" id="nonterm-ital" class="redraw" /><label for="nonterm-ital">Italic</label>
					</span></td>
				</tr>
				<tr>
					<td align="left">Font size:</td>
					<td width="100%"><div id="font-size-slider"></div></td>
				</tr>
				<tr>
					<td align="left">Vertical spacing:</td>
					<td width="100%"><div id="vert-space-slider"></div></td>
				</tr>
				<tr>
					<td align="left">Horizontal spacing:</td>
					<td width="100%"><div id="hor-space-slider"></div></td>
				</tr>
				<tr>
					<td colspan="2" align="center"><button id="make-link" type="button">Link to this tree</button></td>
				</tr>
			</table>
		</div>
	
		<h3><a href="#">Help</a></h3><div class="help">
			<h3>How to build a tree</h3>
			<p>Use labelled square brackets to denote constituants. To draw triangles, include a caret ^ in the label. This app will build the tree as you type and will attempt to close any brackets that you may be missing. Save the image to your computer by right-clicking on it and selecting "Save image as".</p>
			<h3>Examples:</h3>
			<a class="example" href="index.html?[NP^ Alice]">[NP^ Alice]</a><br />
			<a class="example" href="index.html?[NP [N Alice] and [N Bob]]">[NP [N Alice] and [N Bob]]</a><br />
			<a class="example" href="index.html?[S[NP[N Alice]][VP[V is][NP[N'[N a student][PP^ of physics]]]]]">[S[NP[N Alice]][VP[V is][NP[N'[N a student][PP^ of physics]]]]]</a><br />
			<h3>Movement Lines and Subscripts:</h3>
			<p>To show movement, mark the head of the movement with an underscore followed by a tag after the category label. Mark the tail with the same tag between angled brackets. The head constituent can not be an ancestor of the tail. Tags can only consist of letters and numbers. Tags that consist of only numbers will appear in subscript after the category label.</p>
			<a class="example" href="index.html?[CP [NP^_1 What] [C' [C_b did] [IP_2 [NP^ you] [I' [I tr&lt;b&gt;] [VP [V' [V eat] tr&lt;1&gt;]]]]]]">[CP [NP^_1 What] [C' [C_b did] [IP_2 [NP^ you] [I' [I tr&lt;b&gt;] [VP [V' [V eat] tr&lt;1&gt;]]]]]]</a>
			<h3>Download</h3>
			<p>Click <a href="https://github.com/mshang/syntree/zipball/master">here</a> to download this app for offline use. Extract the .zip file to a location of your choice. To run the app, go to that location and run "index.html". In Internet Explorer, you may have to click "Allow blocked content" for trees to appear.</p>
		</div>
	</div>
	<br />

	<div id="image-goes-here"></div>


<style type="text/css">
body { font-size: small !important; font-family: sans-serif; margin: 20px; background: #ffffff;}
#accordion { margin: 0px auto; width: 500px; text-align: center; }
table { margin: 0px auto; }
//.ui-widget { font-size:small !important; }
td {font-size:small !important;}
textarea {resize: none; width: 100%}
a.example { text-decoration: none; }
.help {text-align: left;}
#image-goes-here { text-align: center; }
img { border: 1px solid #bbbbbb; }
</style>

<link type="text/css" href="css/cupertino/jquery-ui-1.8.18.custom.css" rel="stylesheet" />	
<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.18.custom.min.js"></script>
<script type="text/javascript" src="js/base64.js"></script>
<script type="text/javascript" src="js/canvas2image.js"></script>
<script type="text/javascript" src="js/syntree.js"></script>
<script type="text/javascript">

function handler(font_size_update, vert_space_update, hor_space_update) {
try {
	// Initialize the various options.
	var term_font = "";
	var nonterm_font = "";
	if (document.getElementById("term-ital").checked)
		term_font = term_font + "italic ";
	if (document.getElementById("term-bold").checked)
		term_font = term_font + "bold ";
	if (document.getElementById("nonterm-ital").checked)
		nonterm_font = nonterm_font + "italic ";
	if (document.getElementById("nonterm-bold").checked)
		nonterm_font = nonterm_font + "bold ";
	font_size = $("#font-size-slider").slider( "option", "value" );
	vert_space = $("#vert-space-slider").slider( "option", "value" );
	hor_space = $("#hor-space-slider").slider( "option", "value" );
	if (font_size_update) font_size = font_size_update;
	if (vert_space_update) vert_space = vert_space_update;
	if (hor_space_update) hor_space = hor_space_update;
	term_font = term_font + font_size + "pt ";
	nonterm_font = nonterm_font + font_size + "pt ";
	term_font = term_font + $('input:radio[name=font-style]:checked').val();
	nonterm_font = nonterm_font + $('input:radio[name=font-style]:checked').val();
	
	// Get the string.
	var str = document.getElementById("i").value;
	
	/*$("#image-goes-here").text(str + ", " + font_size + ", " + 
		term_font + ", " + nonterm_font + ", " + vert_space + ", " + hor_space);*/
	
	var img = go(str, font_size, term_font, nonterm_font, vert_space, hor_space);
	$("#image-goes-here").empty();
	$("#image-goes-here").append(img);
	
} catch (err) {
	if (debug) {
		alert(err);
	} else { 
		if (err == "canvas")
			$("#image-goes-here").text("Browser not supported.");
	}
} // try-catch
return false;
} // handler()

$(function() {
	// UI
	$("#make-link").button();
	$("#font-size-slider").slider({value: 12, min: 8, max: 16, step: 1});
	$("#vert-space-slider").slider({value: 40, min: 30, max: 70, step: 5});
	$("#hor-space-slider").slider({value: 10, min: 10, max: 50, step: 5});
	$("#font-style-radio, #term-font-check, #nonterm-font-check").buttonset();
	$("#accordion").accordion({collapsible: true, icons: false, autoHeight: false});
	
	try {
		var qs = decodeURIComponent(window.location.search.slice(1));
		qs = qs.replace(/^i=/,"");
		if (qs == "") throw "";
		document.getElementById("i").value = qs;
	} catch (err) {}
	
	handler();
	
	// Events
	$("#i").keyup(function() {return handler()});
	$("#i").change(function() {return handler()});
	$(".redraw").change(function() {return handler()});
	$("#make-link").click(function() {
		window.prompt ("Address:", "http://mshang.github.com/syntree/?i=" +
			encodeURIComponent(document.getElementById("i").value));
	});
	$("#font-size-slider").bind("slide", function (event, ui) {
		handler(ui.value, null, null); return true;
	});
	$("#vert-space-slider").bind("slide", function (event, ui) {
		handler(null, ui.value, null); return true;
	});
	$("#hor-space-slider").bind("slide", function (event, ui) {
		handler(null, null, ui.value); return true;
	});
});
</script>

</body>
</html>